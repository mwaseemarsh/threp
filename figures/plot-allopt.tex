\begin{figure}[!htb]
\begin{center}
\begin{tikzpicture} [
						my brace/.style={thick, decorate, decoration={brace, amplitude=4pt, raise=4pt,},},							
						my label/.style={below right, align=center, rotate=90, inner ysep=10pt, },
					]

\begin{axis} [name=plot1, height=\figheight, width=\figwidth, 
				   enlarge y limits={upper,value=0.3},  enlarge x limits=0.12,
				   ymin=0,
		           %axis y line*=left,
				   ybar=\ybarSep,  
				   x=\ybarXdist,
				   bar width=\ybarWidth,
	   			   ylabel={worst-case  latency($\mu{}s$)},
	 		       symbolic x coords={no load, cache\_pressure, forkops, fileops, threadops},
		           xtick=data,                 
		            %nodes near coords, 
					%nodes near coords align={vertical}, 
					x tick label style={rotate=0, anchor=north, font=\ttfamily\small}, 
					%% xticklabel style={rotate=0,anchor=north, xshift=8pt, font=\ttfamily\small},
		            xtick align=inside,
		            xticklabel pos=left,
	   			    legend pos=north east, legend columns=-1,
			 ]                    
	\addplot [fill=NavyBlue!50, xshift=\xShiftLatency] coordinates {
                    (no load,130.8) 
					(cache\_pressure,141.7)	
					(forkops,119.5)
					(fileops,146.4)
					(threadops,169.1)
			      }
					coordinate [pos=0] (a1)
		            coordinate [pos=0.2] (a2)
		            coordinate [pos=0.4] (a3)
		            coordinate [pos=0.8] (a4)
		            coordinate [pos=1] (a5)
				  ;

	\addplot [fill=ForestGreen!60, xshift=\xShiftLatency, postaction={pattern=crosshatch dots}, pattern color=gray] coordinates {
                    (no load,97.7) 
					(cache\_pressure,102.2)	
					(forkops,93.6)
					(fileops,100.7)
					(threadops,96.8)
			      }
				  	coordinate [pos=0] (b1)
		            coordinate [pos=0.2] (b2)
		            coordinate [pos=0.4] (b3)
		            coordinate [pos=0.8] (b4)
		            coordinate [pos=1] (b5)	
				  ;

				  \draw [my brace] (a1) -- (b1) node [my label] {\small{$+25.3\%$}};
				  \draw [my brace] (a2) -- (b2) node [my label] {\small{$+27.9\%$}};
				  \draw [my brace] (a3) -- (b3) node [my label] {\small{$+21.6\%$}};
				  \draw [my brace] (a4) -- (b4) node [my label] {\small{$+31.2\%$}};
				  \draw [my brace] (a5) -- (b5) node [my label] {\small{$+42.8\%$}};
	\legend{no optimization, all optimizations}
	\end{axis}

	%%improvement%% 
	%% 	\begin{axis} [ name=plot1, height=\figheight, width=\figwidth, ybar,  enlarge y limits={upper,value=0.3},  enlarge x limits=0.12, 					
	%% 			   ymin=0, ymax=80,
	%% 	           axis y line*=right,
	%% 			   ybar=\ybarSep,  
	%% 			   x=\ybarXdist,
	%% 			   bar width=\ybarWidth,
	%%    			   ylabel={improvement \%},
	%%  		       symbolic x coords={no load, cache pressure, forkops, fileops, threadops},
	%% 	           xtick=data,                 
	%% 	            nodes near coords, 
	%% 				nodes near coords align={vertical}, 
	%% 				x tick label style={rotate=0, anchor=north}, 
	%% 				xticklabel style={rotate=0,anchor=north},
	%% 	            xtick align=inside,
	%% 	            xticklabel pos=left,
	%%    			    legend pos=north east, legend columns=-1,
	%% 	         ]  
	%% 	\addplot [fill=OliveGreen!50, xshift=\xShiftImprove, postaction={pattern=crosshatch dots}] coordinates {
    %%                 (no load, 25.3) 
	%% 				(cache pressure,27.9)	
	%% 				(forkops,21.6)
	%% 				(fileops,31.2)
	%% 				(threadops,42.8)
	%% 		      };
	%% 	\legend{improvement}
	%% 	\end{axis}

%%%%%%%%%%%%%%%%%%for defense presentation%%%%%%%%%%%%%%%%%%%%
\ifdefense

\end{tikzpicture}
\end{center}
\label{plot-allopt1}
\end{figure}
	
\begin{figure}[!htb]
\begin{center}
\begin{tikzpicture}[
						my brace/.style={thick, decorate, decoration={brace, amplitude=4pt, raise=4pt,},},							
						my label/.style={below right, align=center, rotate=90, inner ysep=10pt, },
					]

\fi
%%%%%%%%%%%%%%%%%%%%%ENDIF%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

	\begin{axis} [name=plot2, \atCmdLowerPlot, 
					height=\figheight, width=\figwidth, enlarge y limits={upper,value=0.3},  
					enlarge x limits=0.12,
				   ymin=0,
		           %axis y line*=left,
				   ybar=\ybarSep,
				   x=\ybarXdist,
				   bar width=\ybarWidth,
	   			   ylabel={average-case latency ($\mu{}s$)},
	 		       symbolic x coords={no load, cache\_pressure, forkops, fileops, threadops},
		           xtick=data,                 
		            %nodes near coords, 
					%nodes near coords align={vertical}, 
					x tick label style={rotate=0, anchor=north, font=\ttfamily\small}, 
					%% xticklabel style={rotate=0,anchor=north},
		            xtick align=inside,
		            xticklabel pos=left,
	   			    legend pos=north east, legend columns=-1,
				]                    
		\addplot [fill=NavyBlue!50, xshift=\xShiftLatency] coordinates {
                    (no load,18.2) 
					(cache\_pressure,26.6)	
					(forkops,12.6)
					(fileops,14.3)
					(threadops,16.4)			
			      }
					coordinate [pos=0] (a1)
		            coordinate [pos=0.2] (a2)
		            coordinate [pos=0.4] (a3)
		            coordinate [pos=0.8] (a4)
		            coordinate [pos=1] (a5)
				  ;
		\addplot [fill=ForestGreen!60, xshift=\xShiftLatency, postaction={pattern=crosshatch dots}, pattern color=gray] 				
				coordinates {
                    (no load,11) 
					(cache\_pressure,10.9)	
					(forkops,7.6)
					(fileops,7.7)
					(threadops,9.6)			
			      }
				  	coordinate [pos=0] (b1)
		            coordinate [pos=0.2] (b2)
		            coordinate [pos=0.4] (b3)
		            coordinate [pos=0.8] (b4)
		            coordinate [pos=1] (b5)	
				  ;

				  \draw [my brace] (a1) -- (b1) node [my label] {\small{$+39.5\%$}};
				  \draw [my brace] (a2) -- (b2) node [my label] {\small{$+59\%$}};
				  \draw [my brace] (a3) -- (b3) node [my label] {\small{$+39.7\%$}};
				  \draw [my brace] (a4) -- (b4) node [my label] {\small{$+46.2\%$}};
				  \draw [my brace] (a5) -- (b5) node [my label] {\small{$+41.5\%$}};
		\legend{no optimization, all optimizations}
		\end{axis}

	%%improvement%%
	%% \begin{axis} [ name=plot2, \atCmdLowerPlot,  height=\figheight, width=\figwidth, ybar,  
	%% 				enlarge y limits={upper,value=0.3},  enlarge x limits=0.12, ymin=0, ymax=80,
	%% 	           axis y line*=right,
	%% 			   ybar=\ybarSep,  
	%% 			   x=\ybarXdist,             
	%% 			   bar width=\ybarWidth,
	%%    			   ylabel={improvement \%},
	%%  		       symbolic x coords={no load, cache pressure, forkops, fileops, threadops},
	%% 	           xtick=data,                 
	%% 	            nodes near coords, 
	%% 				nodes near coords align={vertical}, 
	%% 				x tick label style={rotate=0, anchor=north}, 
	%% 				xticklabel style={rotate=0,anchor=north},
	%% 	            xtick align=inside,
	%% 	            xticklabel pos=left,
	%%    			    legend pos=north east, legend columns=-1,
	%% 	         ]  
	%% \addplot [fill=OliveGreen!50, xshift=\xShiftImprove, postaction={pattern=crosshatch dots}] coordinates {
    %%                 (no load,39.5) 
	%% 				(cache pressure,59)	
	%% 				(forkops,39.7)
	%% 				(fileops,46.2)
	%% 				(threadops,41.5)
	%% 		      };
	%% \legend{improvement}
	%% \end{axis}


\end{tikzpicture}
\end{center}
\ifreport
\caption{Comparison of interrupt latency when no optimization is deployed versus latency reduction techniques (direct interrupt, cache allocation, isolated TLB cache)}
\label{plot-allopt}
\else
\label{plot-allopt2}
\fi
\end{figure}

