\begin{figure}[!htb]
\begin{center}
\begin{tikzpicture} [
						my brace/.style={thick, decorate, decoration={brace, amplitude=4pt, raise=4pt,},},							
						my label/.style={below right, align=center, rotate=90, inner ysep=10pt, },
					]

	%%%%%%% worst case %%%%%%%%%%%%%%
	\begin{axis} [ name=plot1, height=\figheight, width=\figwidth, 
				   enlarge y limits={upper,value=0.3},  enlarge x limits=0.12,
				   ymin=0,
		           %axis y line*=left,
				   ybar=\ybarSep,  
				   x=\ybarXdist,
				   bar width=\ybarWidth,
	   			   ylabel={worst-case  latency ($\mu{}s$)},
	 		       symbolic x coords={no load, cache\_pressure, forkops, fileops, threadops},
		           xtick=data,                 
		            %nodes near coords, 
					%nodes near coords align={vertical}, 
					x tick label style={rotate=0, anchor=north, font=\ttfamily\small}, 
					%% xticklabel style={rotate=0,anchor=north},
		            xtick align=inside,
		            xticklabel pos=left,
	   			    legend pos=north east, legend columns=-1,
				]     
               
	%% absolute values
	\addplot [fill=NavyBlue!50, xshift=\xShiftLatency] coordinates {
                    (no load,133.9) 
					(cache\_pressure,135.8)	
					(forkops,127.1)
					(fileops,127.6)
					(threadops,131.7)
			      }
					coordinate [pos=0] (a1)
		            coordinate [pos=0.2] (a2)
		            coordinate [pos=0.4] (a3)
		            coordinate [pos=0.8] (a4)
		            coordinate [pos=1] (a5)
				  ;

	\addplot [fill=ForestGreen!60, xshift=\xShiftLatency, postaction={pattern=crosshatch dots}, pattern color=gray] coordinates {
                    (no load,101.5) 
					(cache\_pressure,101.2)	
					(forkops,101.9)
					(fileops,101.1)
					(threadops,99.9)
			      }
				  	coordinate [pos=0] (b1)
		            coordinate [pos=0.2] (b2)
		            coordinate [pos=0.4] (b3)
		            coordinate [pos=0.8] (b4)
		            coordinate [pos=1] (b5)	
				  ;

				  \draw [my brace] (a1) -- (b1) node [my label] {\small{$+24.2\%$}};
				  \draw [my brace] (a2) -- (b2) node [my label] {\small{$+24.8\%$}};
				  \draw [my brace] (a3) -- (b3) node [my label] {\small{$+19.2\%$}};
				  \draw [my brace] (a4) -- (b4) node [my label] {\small{$+20.7\%$}};
				  \draw [my brace] (a5) -- (b5) node [my label] {\small{$+24.1\%$}};

	\legend{virtual interrupt, direct interrupt}
	\end{axis}

	%%improvement%%
	%% \begin{axis} [ name=plot1, height=\figheight, width=\figwidth, ybar,  enlarge y limits={upper,value=0.3},  enlarge x limits=0.12, 					
	%% 			   ymin=0, ymax=80,
	%% 	           axis y line*=right,
	%% 			   ybar=\ybarSep,  
	%% 			   x=\ybarXdist,
	%% 			   bar width=\ybarWidth,
	%%    			   ylabel={improvement \%},
	%%  		       symbolic x coords={no load, cache pressure, forkops, fileops, threadops},
	%% 	           xtick=data,                 
	%% 	            nodes near coords, 
	%% 				nodes near coords align={vertical}, 
	%% 				x tick label style={rotate=0, anchor=north}, 
	%% 				xticklabel style={rotate=0,anchor=north},
	%% 	            xtick align=inside,
	%% 	            xticklabel pos=left,
	%%    			    legend pos=north east, legend columns=-1,
	%% 	         ]  
	%% \addplot [fill=OliveGreen!50, xshift=\xShiftImprove, postaction={pattern=crosshatch dots}] coordinates {
    %%                 (no load,24.2) 
	%% 				(cache pressure,24.8)	
	%% 				(forkops,19.8)
	%% 				(fileops,20.7)
	%% 				(threadops,24.1)
	%% 		      };
	%% \legend{improvement}
	%% \end{axis}

%%%%%%% average case %%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%for defense presentation%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%IF%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ifdefense

\end{tikzpicture}
\end{center}
\label{plot-dii1}
\end{figure}
	
\begin{figure}[!htb]
\begin{center}
\begin{tikzpicture} [
						my brace/.style={thick, decorate, decoration={brace, amplitude=4pt, raise=4pt,},},							
						my label/.style={below right, align=center, rotate=90, inner ysep=10pt, },
					]
%%%%%%%%%%%%%%%%%%%%%ENDIF%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\fi
	\begin{axis} [ name=plot2, \atCmdLowerPlot,  height=\figheight, width=\figwidth, enlarge y limits={upper,value=0.3},  enlarge x limits=0.12,
			   ymin=0,
               %axis y line*=left,
			   ybar=\ybarSep,
			   x=\ybarXdist,
		       bar width=\ybarWidth,
   			   ylabel={average-case latency ($\mu{}s$)},
 		       symbolic x coords={no load, cache\_pressure, forkops, fileops, threadops},
               xtick=data,                 
                %nodes near coords, 
				%nodes near coords align={vertical}, 
				x tick label style={rotate=0, anchor=north, font=\ttfamily\small}, 
				%% xticklabel style={rotate=0,anchor=north},
                xtick align=inside,
                xticklabel pos=left,
   			    legend pos=north east, legend columns=-1,
			]                    
	\addplot [fill=NavyBlue!50, xshift=\xShiftLatency] coordinates {
                    (no load,19.6) 
					(cache\_pressure,19.4)	
					(forkops,14)
					(fileops,15.1)
					(threadops,11.9)			
			      }
					coordinate [pos=0] (a1)
		            coordinate [pos=0.2] (a2)
		            coordinate [pos=0.4] (a3)
		            coordinate [pos=0.8] (a4)
		            coordinate [pos=1] (a5)
					;
	\addplot [fill=ForestGreen!60, xshift=\xShiftLatency, postaction={pattern=crosshatch dots}, pattern color=gray] coordinates {
                    (no load,11) 
					(cache\_pressure,11.4)	
					(forkops,8)
					(fileops,8)
					(threadops,11.3)			
 				    }
				  	coordinate [pos=0] (b1)
		            coordinate [pos=0.2] (b2)
		            coordinate [pos=0.4] (b3)
		            coordinate [pos=0.8] (b4)
		            coordinate [pos=1] (b5)	
					;

				  \draw [my brace] (a1) -- (b1) node [my label] {\small{$+43.8\%$}};
				  \draw [my brace] (a2) -- (b2) node [my label] {\small{$+41.2\%$}};
				  \draw [my brace] (a3) -- (b3) node [my label] {\small{$+42.9\%$}};
				  \draw [my brace] (a4) -- (b4) node [my label] {\small{$+47\%$}};
				  \draw [thick, |-|] ([xshift=4pt]a5) -- ([xshift=4pt]b5) node [my label] {\small{$+5\%$}};

	\legend{virtual interrupt, direct interrupt}
	\end{axis}

	%%improvement%%
	%% \begin{axis} [ name=plot2, \atCmdLowerPlot,  height=\figheight, width=\figwidth, ybar,  
	%% 				enlarge y limits={upper,value=0.3},  enlarge x limits=0.12, ymin=0, ymax=80,
	%% 	           axis y line*=right,
	%% 			   ybar=\ybarSep,  
	%% 			   x=\ybarXdist,             
	%% 			   bar width=\ybarWidth,
	%%    			   ylabel={improvement \%},
	%%  		       symbolic x coords={no load, cache pressure, forkops, fileops, threadops},
	%% 	           xtick=data,                 
	%% 	            nodes near coords, 
	%% 				nodes near coords align={vertical}, 
	%% 				x tick label style={rotate=0, anchor=north}, 
	%% 				xticklabel style={rotate=0,anchor=north},
	%% 	            xtick align=inside,
	%% 	            xticklabel pos=left,
	%%    			    legend pos=north east, legend columns=-1,
	%% 	         ]  
	%% \addplot [fill=OliveGreen!50, xshift=\xShiftImprove, postaction={pattern=crosshatch dots}] coordinates {
    %%                 (no load,43.8) 
	%% 				(cache pressure,41.2)	
	%% 				(forkops,42.9)
	%% 				(fileops,47)
	%% 				(threadops,5)
	%% 		      };
	%% \legend{improvement}
	%% \end{axis}

\end{tikzpicture}
\end{center}
\ifreport
\caption{Interrupt Latency comparison for virtual and direct interrupt injection}
\label{plot-dii}
\else
\label{plot-dii2}
\fi
\end{figure}
